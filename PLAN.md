# План добавления функций кнопок «О чем статья?», «Тезисы», «Пост для Telegram»

На основании [PROJECT.md](./PROJECT.md): приложение получает URL статьи, выполняет парсинг и по нажатию кнопки подключает AI для нужного действия. Ниже — порядок действий для реализации трёх кнопок.

---

## 1. Общие предпосылки

- Уже есть: парсинг статьи по URL (API `/api/parse`), перевод через OpenRouter (API `/api/translate`), кнопки и блок результата.
- Кнопки «О чем статья?», «Тезисы», «Пост для Telegram» сейчас работают как заглушки (mock). Нужно заменить заглушки на вызовы AI по распарсенному контенту.

---

## 2. Порядок действий

### Шаг 1. Единый API для AI-действий

- Создать один API route (например, `/api/summarize` или `/api/action`) или три отдельных (`/api/about`, `/api/theses`, `/api/telegram`).
- Рекомендация: один route с параметром `action: 'about' | 'theses' | 'telegram'`, чтобы не дублировать логику вызова OpenRouter и чтения `OPENROUTER_API_KEY`.
- Вход: `{ text: string, action: 'about' | 'theses' | 'telegram' }`. Входной `text` — распарсенный контент статьи (или title + content).

### Шаг 2. Промпты для каждого действия

- Описать в коде (или в конфиге) системные/пользовательские промпты для OpenRouter:
  - **О чем статья?** — краткое описание статьи (1–2 абзаца), без списков и поста.
  - **Тезисы** — ключевые тезисы в виде нумерованного или маркированного списка.
  - **Пост для Telegram** — короткий пост (1–3 абзаца), готовый к публикации в Telegram (можно указать ограничение по длине/символам).
- Использовать модель Deepseek (как для перевода): `deepseek/deepseek-chat` через OpenRouter.

### Шаг 3. Зависимость от распарсенных данных

- Кнопки «О чем статья?», «Тезисы», «Пост для Telegram» должны работать только при наличии распарсенного контента (аналогично кнопке «Перевести»).
- В `app/page.tsx`:
  - Передавать в API контент из `parsedData.content` (и при необходимости `parsedData.title`).
  - Блокировать кнопки (disabled), если `!parsedData?.content`, и показывать подсказку (например, через `title` или текст под кнопками): «Сначала распарсите статью».

### Шаг 4. Замена заглушек в обработчике кнопок

- В `handleRun(nextMode)` убрать `setTimeout` с mock-ответами.
- Вместо этого:
  - Проверять наличие `parsedData?.content`; при отсутствии — показывать ошибку и не вызывать API.
  - Вызывать новый API (например, `POST /api/summarize` с `{ text: parsedData.content, action: nextMode }`).
  - Устанавливать состояние загрузки (например, `setIsLoading(true)`), по ответу — `setResult(data.result)` или аналог, затем `setIsLoading(false)`; при ошибке — показывать сообщение в блоке ошибок.

### Шаг 5. Отображение результата

- Ответ от AI выводить в существующий блок «Результат».
- Сохранять отображение текущего режима (бейдж «О чем статья» / «Тезисы» / «Пост для Telegram») в зависимости от выбранной кнопки.
- Для «Тезисы» результат уже предполагается в виде списка; при необходимости можно рендерить текст с `whitespace-pre-line`, чтобы сохранить переносы строк из ответа модели.

### Шаг 6. Обработка ошибок и лимитов

- Обрабатывать ошибки API (сеть, 4xx/5xx от OpenRouter, отсутствие ключа в `.env.local`).
- При необходимости обрезать `parsedData.content` до разумного объёма (например, первые N символов) перед отправкой в API, чтобы не превышать лимиты модели и не тратить лишние токены.

### Шаг 7. Тестирование и уточнение промптов

- Проверить все три кнопки на одной и разных статьях.
- При необходимости скорректировать промпты в API route, чтобы формат ответа (описание, список тезисов, пост) соответствовал ожиданиям.

---

## 3. Краткий чеклист

| # | Действие |
|---|----------|
| 1 | Добавить API route для AI-действий (один или три; вход: текст + тип действия). |
| 2 | Реализовать промпты для «О чем статья?», «Тезисы», «Пост для Telegram». |
| 3 | Связать кнопки с распарсенным контентом (disabled без парсинга, вызов с `parsedData.content`). |
| 4 | Заменить заглушки в `handleRun` на вызов нового API и отображение ответа. |
| 5 | Выводить результат в блок «Результат», сохранять бейдж режима. |
| 6 | Добавить обработку ошибок и при необходимости ограничение длины текста. |
| 7 | Протестировать и при необходимости доработать промпты. |

---

После выполнения плана все три кнопки будут использовать распарсенный по URL контент и OpenRouter (Deepseek) для генерации описания, тезисов и поста для Telegram, как указано в PROJECT.md.
